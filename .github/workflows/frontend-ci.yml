name: Frontend CI

on:
  push:
    branches: [main, develop, CI/CD_automatizado]
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend-ci.yml'
  pull_request:
    branches: [main, develop]
    paths:
      - 'frontend/**'
      - '.github/workflows/frontend-ci.yml'

defaults:
  run:
    working-directory: frontend

jobs:
  quality:
    name: Qualidade de C√≥digo
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Instalar depend√™ncias
        run: npm ci
      
      - name: Type Check com TypeScript
        run: |
          npx tsc --noEmit
      
      - name: Lint com ESLint
        run: |
          npm run lint || echo "‚ö†Ô∏è Configure ESLint em package.json"
        continue-on-error: true
      
      - name: Verificar formata√ß√£o com Prettier
        run: |
          npm run format:check || echo "‚ö†Ô∏è Configure Prettier em package.json"
        continue-on-error: true

  build:
    name: Build de Produ√ß√£o
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Instalar depend√™ncias
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Verificar tamanho do bundle
        run: |
          echo "üì¶ Tamanho do build de produ√ß√£o:"
          ls -lh dist/ 2>/dev/null || ls -lh build/
          du -sh dist/ 2>/dev/null || du -sh build/
      
      - name: Upload do build como artefato
        uses: actions/upload-artifact@v4
        with:
          name: frontend-build-${{ github.sha }}
          path: frontend/dist/
          retention-days: 7

  tests:
    name: Testes (Vitest)
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Instalar depend√™ncias
        run: npm ci
      
      - name: Executar testes
        run: |
          npm test || echo "‚ö†Ô∏è Testes ainda n√£o configurados"
        continue-on-error: true