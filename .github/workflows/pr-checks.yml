name: PR Checks

on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened]

jobs:
  validate-pr:
    name: Validar Pull Request
    runs-on: ubuntu-latest    
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Verificar tamanho da PR
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            
            console.log(`üìä Estat√≠sticas da PR:`);
            console.log(`   Arquivos alterados: ${pr.changed_files}`);
            console.log(`   Linhas adicionadas: ${pr.additions}`);
            console.log(`   Linhas removidas: ${pr.deletions}`);
            
            const totalChanges = pr.additions + pr.deletions;
            
            if (pr.changed_files > 30) {
              core.warning(
                `‚ö†Ô∏è Esta PR altera ${pr.changed_files} arquivos. ` +
                `PRs grandes s√£o mais dif√≠ceis de revisar. ` +
                `Considere dividir em PRs menores.`
              );
            }
            
            if (totalChanges > 1000) {
              core.warning(
                `‚ö†Ô∏è Esta PR tem ${totalChanges} linhas de mudan√ßa. ` +
                `PRs menores facilitam o code review.`
              );
            } else {
              core.info(`‚úÖ Tamanho da PR est√° adequado`);
            }
      
      - name: Verificar descri√ß√£o da PR
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            const body = pr.body || '';
            
            if (body.length < 30) {
              core.warning(
                '‚ö†Ô∏è Descri√ß√£o da PR muito curta! ' +
                'Por favor, explique:\n' +
                '  - O que foi alterado\n' +
                '  - Por que foi alterado\n' +
                '  - Como testar'
              );
            } else {
              core.info('‚úÖ Descri√ß√£o da PR adequada');
            }
      
      - name: Verificar se PR tem label
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            
            if (pr.labels.length === 0) {
              core.notice(
                'üí° Dica: Adicione labels √† PR (feat, fix, docs, etc.) ' +
                'para facilitar organiza√ß√£o'
              );
            }
  
  lint:
    name: Verificar Formato (Black)
    runs-on: ubuntu-latest
    needs: [validate-pr]
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
        
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Instalar Black
        run: pip install black
        
      - name: Executar Black (check)
        run: black --check .

  summary:
    name: Resumo das Verifica√ß√µes
    runs-on: ubuntu-latest
    needs: [validate-pr, lint]
    if: always()
    
    steps:
      - name: Resumo
        run: |
          echo "‚úÖ Verifica√ß√µes de PR conclu√≠das"
          echo "üëÄ Aguardando code review..."